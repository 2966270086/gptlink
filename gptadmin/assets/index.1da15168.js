var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,n=(e,a)=>{for(var t in a||(a={}))o.call(a,t)&&r(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&r(e,t,a[t]);return e},d=(e,l)=>a(e,t(l));import{d as i,c,f as p,e as u}from"./index.1b2875f3.js";import{a as m,m as f,M as h,E as y,r as b,a0 as v,d as g,u as V,h as w,i as _,c as P,f as C,w as x,b as k,P as D,Q as S,R as M,au as I,t as U,H as j,g as G,bv as R,o as T,az as O,e as B,bb as q,aA as z}from"./vendor.805d0475.js";import{u as E}from"./useDialog.796bffee.js";import{u as L}from"./useBasicForm.4db03463.js";import{a as H}from"./index.afdd0a4f.js";import{u as A}from"./useBasicTable.7791b58f.js";const F=(e=!1,a=!1)=>[{field:"name",component:"Input",label:"模型名称",required:!0,componentProps:{placeholder:"请输入模型名称"}},{field:"type",component:"Input",label:"类型",required:!0,slot:"type",defaultValue:"1"},{field:"system",component:"Input",label:"咒语",required:!0,componentProps:{type:"textarea",rows:6,placeholder:"请输入咒语"}},{field:"desc",component:"Input",label:"模型描述",required:!0,componentProps:{type:"textarea",rows:2,placeholder:"请输入模型描述"}},{field:"remark",component:"Input",label:"备注",componentProps:{type:"textarea",rows:2,placeholder:"请输入备注"}},{field:"prompt",component:"Input",label:e?"示例":"开场语",required:!0,slot:"prompt"}];const Q=()=>{const e=m({}),a=f();return d(n({},h(e)),{onModelShow:async(e,a,t="mf")=>{const l={id:e.id,status:1==e.status?"2":"1"};"gpt"===t&&(l.status=e.status);try{const{err_code:e}=await H().chatGPT.putChatGptModelStatus(n({},l));e||a&&a()}catch(o){}},onCreateModel:async(e,a)=>{try{const t=!!e.id,{err_code:l}=await H().chatGPT[t?"putChatGptModel":"saveChatGptModel"](n({},e));l||(y.success(t?"修改成功":"新增成功"),a&&a())}catch(t){}},handleCopyModel:async(e,t="list")=>a.push({path:`/model/modelManager/${t}`,query:{id:e}}),handleModelTop:async(e,a,t)=>{try{const{err_code:l}=await H().model[a?"cancelTop":"modelTop"]({id:e});l||(y.success(a?"取消置顶成功":"置顶成功"),t&&t())}catch(l){}},onGetModalInfo:e=>new Promise(((a,t)=>{H().chatGPT.getChatGptModelInfo({id:e}).then((({err_code:e,data:t})=>{e||a(t)})).catch((e=>{t(e)}))}))})};const W={class:"spell-form"},$={class:"picture cb-flex"},J=["onClick"],K={class:"picture"},N={class:"picture-img"},X=["src","alt"],Y={class:"picture-mask"},Z={class:"picture-mask-box cb-flex"},ee={class:"picture-info cb-single-line"},ae=g({__name:"SelectModalImg",props:{modelValue:{type:[Boolean],default:!1},editData:{type:[Array],default:()=>null},typePlatform:{type:String,default:"2"}},emits:["update:modelValue","onSuccess"],setup(e,{emit:a}){const t=e,l=b(-1),{resourcesList:o,onGetResourcesList:s}=(()=>{const e=b([]),a=m({page:{page:1,per_page:20},total:0}),t=async(t={})=>{try{const{err_code:l,data:o,meta:s}=await H().resources.materialList(n(n({},a.page),t));l||(e.value=o,a.total=s.total)}catch(l){}};return d(n({resourcesList:e},h(a)),{handleSaveResources:async(e,a)=>{try{const{err_code:t}=await H().resources.materialSave(e);t||(y.success("新增成功"),a&&a())}catch(t){}},handleDeleteResources:async(e,a)=>{v.confirm("确定删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then((async()=>{try{const{err_code:l}=await H().resources.materialDel({id:e});l||(y.success("删除成功"),t(a))}catch(l){}}))},onGetResourcesList:t})})(),{getEditId:r,getEdit:c,handlePopup:p}=E({props:t,emit:a,watchShow:e=>{t.modelValue&&s({type:V(t.typePlatform),is_all:1}),t.editData}}),u=()=>{if(V(l)<0)return y.error("请选择图片");a("onSuccess",o.value[V(l)]),p(!1)};return(a,t)=>{const s=w("el-icon");return _(),P("div",null,[C(V(i),{"dialog-props":{title:"模型图片",modelValue:e.modelValue,showClose:!0,width:"850px"},scrollBarProps:{maxHeight:700},center:"",top:"10vh",onCancel:t[0]||(t[0]=e=>V(p)(!1)),onSubmit:u},{default:x((()=>[k("div",W,[k("div",$,[(_(!0),P(D,null,S(V(o),((e,a)=>(_(),P("div",{key:e.id,onClick:e=>l.value=a,class:M(["picture-item cb-m-r-10 cb-m-b-10",{active:a===l.value}])},[k("div",K,[k("div",N,[k("img",{src:e.file_url,class:"img",alt:e.title},null,8,X)]),k("div",Y,[k("div",Z,[C(s,{size:66,color:"#ffffff"},{default:x((()=>[C(V(I))])),_:1})])])]),k("div",ee,U(e.title),1)],10,J)))),128))])])])),_:1},8,["dialog-props"])])}}});const te={class:"package"},le=G("查看示例"),oe=G("点击前往选择"),se={key:0},re={key:1},ne=G("对话式 "),de=k("span",{class:"package-tip"},"无限聊天的效果",-1),ie=["src"],ce=g({__name:"ListCreateDialog",props:{modelValue:{type:[Boolean],default:!1},editData:{type:[Array],default:()=>null},platform:{type:String,default:"1"}},emits:["update:modelValue","reload"],setup(e,{emit:a}){const t=e,l=b(!1),o=b(!1),{register:s,validate:r,setFieldsValue:u,resetFields:m,setProps:f}=L({schemas:F(!1,"2"==t.platform)}),{getEditId:h,getEdit:y,handlePopup:v}=E({props:t,emit:a,watchShow:e=>{t.editData&&j((()=>{u(d(n({},t.editData),{icon:"2"==t.platform?t.editData.icon?[{url:t.editData.icon}]:[]:t.editData.icon||""}));const e=2==t.editData.type;f({schemas:F(e,"2"==t.platform)})}))}}),{onCreateModel:g}=Q(),D=async()=>{const e=await r();"2"==t.platform&&e.icon&&(e.icon=e.icon[0].url);const l=t.editData?d(n({},e),{platform:t.platform,id:t.editData.id}):d(n({},e),{platform:t.platform});g(l,(()=>{v(),a("reload")}))},S=()=>{v(!1),m()},M=()=>{window.open("https://icon-sets.iconify.design/","_blank")},I=e=>{u({icon:[{url:e.file_url}]})};return(a,t)=>{const r=w("el-input"),n=w("el-button"),d=w("el-radio"),u=w("el-radio-group"),m=w("el-dialog");return _(),P("div",null,[C(V(i),{"dialog-props":{title:"模型新增",modelValue:e.modelValue,showClose:!0,width:"1200px"},scrollBarProps:{maxHeight:600},center:"",top:"10vh",onCancel:S,onSubmit:D},{default:x((()=>[k("div",te,[C(V(c),{onRegister:V(s)},{icon:x((({model:e,field:a})=>[k("div",null,[C(r,{modelValue:e[a],"onUpdate:modelValue":t=>e[a]=t,placeholder:"请输入模型图片",class:"input-with-select"},null,8,["modelValue","onUpdate:modelValue"]),C(n,{link:"",onClick:t[0]||(t[0]=e=>l.value=!0),size:"small"},{default:x((()=>[le])),_:1}),C(n,{link:"",onClick:M,size:"small"},{default:x((()=>[oe])),_:1})])])),prompt:x((({model:e,field:a})=>[2==e.type?(_(),P("div",se,[C(r,{modelValue:e[a],"onUpdate:modelValue":t=>e[a]=t,type:"textarea",rows:4,placeholder:"请输入模型图片"},null,8,["modelValue","onUpdate:modelValue"])])):(_(),P("div",re,[C(V(p),{modelValue:e[a],"onUpdate:modelValue":t=>e[a]=t},null,8,["modelValue","onUpdate:modelValue"])]))])),type:x((({model:e,field:a})=>[C(u,{modelValue:e[a],"onUpdate:modelValue":t=>e[a]=t},{default:x((()=>[C(d,{label:"1"},{default:x((()=>[ne,de])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1},8,["onRegister"])])])),_:1},8,["dialog-props"]),C(m,{modelValue:l.value,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value=e),width:"60%"},{default:x((()=>[k("img",{src:V("/admin/assets/v2_rrupxd.6bf02d46.png"),style:{width:"100%"}},null,8,ie)])),_:1},8,["modelValue"]),C(ae,{modelValue:o.value,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value=e),onOnSuccess:I},null,8,["modelValue"])])}}});const pe={class:"cb-page model"},ue={class:"cb-flex"},me=k("span",{class:"cb-p-t-2"},"新增",-1),fe=["src","alt"],he=G(" 编辑 "),ye=g({__name:"index",setup(e){const a=b(null),t=m({});b(""),b(null);const l=R(),{openEdit:o,editData:s,showDialog:r}=E({}),{onModelShow:i,handleModelTop:c,onGetModalInfo:p}=Q(),f={style:{marginBottom:"20px"}},{registerTable:h,reload:y}=A({columns:[{label:"模型名称",prop:"name"},{label:"模型描述",prop:"desc",customRender:({desc:e})=>e||"--"},{label:"使用量",prop:"uses"},{label:"状态",prop:"status",slot:"状态"},{label:"置顶",prop:"sort",slot:"置顶"},{label:"操作",width:340,slot:"handles"}],formSchemas:[{field:"name",component:"Input",label:"模板名称：",componentProps:{placeholder:"请输入模板名称"}},{field:"type",component:"Select",label:"类型：",componentProps:{style:{width:"100%"},options:[{label:"对话",value:"1"},{label:"问答",value:"2"}]}},{field:"status",component:"Select",label:"状态：",componentProps:{style:{width:"100%"},options:[{label:"上架",value:"1"},{label:"下架",value:"2"}]}}],formConfig:{labelWidth:100,baseColProps:{span:8}}});T((async()=>{if(l.query.id){const e=await p(l.query.id);delete e.id,delete e.icon,o(e)}}));const v=e=>{t.created_at=(e.created_at||[]).join("~")},g=()=>{V(a).reload()};return(e,l)=>{const p=w("el-icon"),m=w("el-button"),y=w("el-switch");return _(),P("div",pe,[C(V(u),{onRegister:V(h),api:V(H)().chatGPT.getChatGptModel,onHandleSearchInfoChange:v,"form-card-options":f,extraParams:d(n({},t),{platform:"1"}),ref_key:"tableRef",ref:a},{"cb-table-header":x((()=>[C(m,{type:"primary",onClick:l[0]||(l[0]=e=>V(o)(null))},{default:x((()=>[k("div",ue,[C(p,{size:20,class:"cb-m-r-2"},{default:x((()=>[C(V(O))])),_:1}),me])])),_:1})])),"模型图片":x((e=>[e.icon?(_(),P("img",{key:0,src:e.icon,alt:e.name,style:{width:"60px",height:"60px"}},null,8,fe)):B("",!0)])),"状态":x((e=>[C(y,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,"active-value":1,"inactive-value":2,onClick:a=>{i(e,(()=>{g()}),"gpt")}},null,8,["modelValue","onUpdate:modelValue","onClick"])])),"置顶":x((e=>[C(y,{modelValue:e.sort,"onUpdate:modelValue":a=>e.sort=a,"active-value":0===e.sort?1:e.sort,"inactive-value":0,onClick:a=>(async(e,a)=>{c(e,a,(()=>{g()}))})(e.id,0===e.sort)},null,8,["modelValue","onUpdate:modelValue","active-value","onClick"])])),handles:x((e=>[C(m,{style:{color:"#9a9a9a","font-size":"12px"},icon:V(q),size:"small",onClick:a=>V(o)(e)},{default:x((()=>[he])),_:2},1032,["icon","onClick"])])),_:1},8,["onRegister","api","extraParams"]),C(ce,{modelValue:V(r),"onUpdate:modelValue":l[1]||(l[1]=e=>z(r)?r.value=e:null),editData:V(s),platform:1,onReload:g},null,8,["modelValue","editData"])])}}});export{ye as default};

import{d as P,r as m,M as A,aO as H,Y as D,O as M,b as _,B as G,C as i,D as S,E as k,F as s,G as r,H as e,_ as O,ar as F,ap as q,a9 as B,I as Q,am as J,P as w,a4 as T,J as K,K as X,L as Y,ae as Z,Z as R,$ as j,ah as W,U as E,a7 as ee,a3 as g,S as te,a8 as se,aL as ae,aP as oe,T as ne,Q as z,R as le}from"./index-4f5d7f8d.js";import{c as re}from"./index-31c42854.js";import{N as ce}from"./InputGroup-06ae9adf.js";import{H as ie}from"./index-b0022267.js";import{T as ue}from"./index-f3eb6038.js";const de="/assets/poster-34c80d2f.png",V=l=>(R("data-v-c846967b"),l=l(),j(),l),pe={class:"share-body w-full flex flex-col items-center justify-center"},me={class:"text-xl text-[white]"},fe=V(()=>s("div",{class:"text-base text-[white] text-center mb-2"}," 专属邀请链接 ",-1)),_e={class:"flex justify-center"},he={id:"poster",class:"poster bg-white overflow-hidden"},ve=["src"],xe=["src"],ye=V(()=>s("div",{class:"w-3/6 text-sm text-[white] text-center mt-2"}," 保存上方图片，分享你专属海报给朋友 ",-1)),be=P({__name:"index",props:{visible:{type:Boolean},data:null,type:null},emits:["update:visible"],setup(l,{emit:C}){const c=l,f=m(""),d=m(""),h=A(),{shareCallback:v}=H(),{isPrivateDomain:p}=D(),{domainConfig:x}=M(),y=_(()=>{var t;return((t=h.authInfo)==null?void 0:t.user)||{}}),I=_(()=>c.data||{}),u=_({get(){return c.visible},set(t){C("update:visible",t)}}),N=_(()=>{const{openid:t}=y.value,{type:a}=e(c);return`${window.location.origin}${a==="distribution"?"/distribution/apply":""}${t?`/?shareOpenId=${t}`:""}`});G(()=>u.value,async()=>{if(u.value){const{openid:t}=y.value,{type:a}=e(c);try{d.value=`${window.location.protocol}://${window.location.host}${a==="/distribution"?"/distribution/apply":""}/${t?`?shareOpenId=${t}`:""}`}catch{}Y(()=>{const o=document.querySelector("#poster");Z(o,{useCORS:!0,scale:4,backgroundColor:null,ignoreElements:n=>{if(W(n.className)&&n.className.includes("poster-img"))return!0},onclone:n=>{const{type:$}=e(c);if($==="distribution"){const b=n.querySelector(".distibution-info");b&&(b.style.transform="translate(-50%, -6.5px)")}else if(p){const b=n.querySelector(".qrcode");b.style.transform="translateX(-13.5px)",b.style.left="50%"}}}).then(n=>{const $=n.toDataURL();f.value=$}).catch(n=>{console.log(n)})})}});function U(){u.value=!1,v(I.value.type)}function L(){re({text:d.value,dom:document.querySelector(".share-body")})}return(t,a)=>(i(),S(e(X),{show:e(u),"onUpdate:show":a[1]||(a[1]=o=>K(u)?u.value=o:null),"auto-focus":!1},{default:k(()=>{var o;return[s("div",pe,[s("div",{class:"close-btn flex justify-center items-center p-2 cursor-pointer fixed top-0 right-0",onClick:U},[s("span",me,[r(e(O),{icon:"material-symbols:close",style:{"font-size":"35px"}})])]),fe,s("div",_e,[r(e(ce),null,{default:k(()=>[r(e(F),{value:d.value,"onUpdate:value":a[0]||(a[0]=n=>d.value=n),class:"flex-1"},null,8,["value"]),r(e(q),{type:"primary",onClick:L},{default:k(()=>[B(" 复制链接 ")]),_:1})]),_:1})]),s("div",he,[s("img",{src:e(p)?(o=e(x))==null?void 0:o.share_img:e(de),class:"w-full h-full poster-bg"},null,8,ve),r(J,{class:Q(["qrcode",{qrcodeCenter:e(p)}]),value:e(N),size:50},null,8,["class","value"]),f.value?(i(),w("img",{key:0,src:f.value,class:"w-full h-full poster-img"},null,8,xe)):T("",!0)]),ye])]}),_:1},8,["show"]))}}),ge=E(be,[["__scopeId","data-v-c846967b"]]),we=l=>(R("data-v-1bd90781"),l=l(),j(),l),ke={class:"bg-white min-h-screen"},$e={class:"mx-auto w-11/12 sm:w-96"},Se={class:"pt-8"},Ce={class:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 flex items-center"},Ie={class:"sm:flex sm:items-end sm:space-x-5 justify-center"},Ne={class:"flex justify-center"},Ue={class:"flex-1 flex items-center userinfo"},Le={class:"flex-1 px-2"},qe={class:"truncate font-bold text-gray-900"},Be={class:"mx-4 flex items-center px-4 py-2 sm:px-6 lg:px-8 mt-6 bg-white shadow-2xl rounded-lg",style:{"--tw-shadow":"0 0px 15px -7px rgb(0 0 0 / 0.5)"}},Te={class:"flex items-center flex-1 mr-4 py-2 text-gray-600"},ze={key:0,class:"px-4 sm:px-6 lg:px-8 mt-4"},Pe=we(()=>s("div",{class:"font-semibold"}," 任务中心 ",-1)),Ae={class:"flex items-center"},De={class:"flex-1 text-base italic font-medium truncate"},Oe={class:"mt-1 text-xs ml-6 truncate"},Re=P({__name:"index",setup(l){const C=ne(),c=A(),{isMobile:f}=D(),d={invite:{title:"邀请好友",btn:"立即邀请",icon:"ant-design:user-add-outlined"},share:{title:"每日分享",btn:"立即分享",icon:"material-symbols:share"}},h=_(()=>{var t;return((t=c.authInfo)==null?void 0:t.user)||{}}),v=m([]),p=m(null),x=m(!1),y=m(null);m("");const I=_(()=>{const t=p.value||{};return Array.isArray(t)?"可用余额不足":t.num===-1?`有效期：${t.expired_at}`:`有效次数：${t.num-t.used}次`}),u=async()=>{const{authInfo:t}=c;if(t)try{const a=await ae.getUserNum();p.value=a}catch{}},N=()=>{C.push({name:"Combo"})},U=async()=>{const t=await oe.getTaskList();v.value=t.filter(a=>a.type!=="register")},L=t=>{x.value=!0,y.value=t};return ee(()=>{u(),U(),c.getUserProfile()}),(t,a)=>(i(),w("div",ke,[r(e(ie),{"hide-back":e(f),title:"个人中心"},null,8,["hide-back"]),s("div",$e,[s("div",Se,[s("div",Ce,[s("div",Ie,[s("div",Ne,[e(h).avatar?(i(),S(e(z),{key:0,size:"medium",round:"",src:e(h).avatar},null,8,["src"])):(i(),S(e(z),{key:1,size:"medium",round:"",src:e(le)},null,8,["src"]))])]),s("div",Ue,[s("div",Le,[s("h1",qe,g(e(h).nickname??""),1)])])])]),s("div",Be,[s("div",Te,g(p.value?e(I):"可用余额不足"),1),r(e(q),{type:"primary",round:"",onClick:N},{default:k(()=>[B(" 去充值 ")]),_:1})]),v.value.length?(i(),w("div",ze,[Pe,(i(!0),w(te,null,se(v.value,(o,n)=>(i(),w("div",{key:n,class:"bg-black rounded-lg shadow text-white py-2 px-3 mt-2"},[s("div",Ae,[r(e(O),{icon:d[o.type].icon,class:"mr-1",style:{color:"#fff","font-size":"20px"}},null,8,["icon"]),s("div",De,g(o.title),1),r(e(q),{round:"",size:"small",style:{background:"#fff"},onClick:$=>L(o)},{default:k(()=>[B(g(d[o.type].btn),1)]),_:2},1032,["onClick"])]),s("div",Oe,g(o.desc),1)]))),128))])):T("",!0)]),r(e(ge),{visible:x.value,"onUpdate:visible":a[0]||(a[0]=o=>x.value=o),data:y.value},null,8,["visible","data"]),e(f)?(i(),S(e(ue),{key:0})):T("",!0)]))}});const Ge=E(Re,[["__scopeId","data-v-1bd90781"]]);export{Ge as default};
